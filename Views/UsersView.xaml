<UserControl x:Class="BL5_PRN212_MustPass_Project.Views.UsersView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="800">
	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="*"/>
			<ColumnDefinition Width="400"/>
		</Grid.ColumnDefinitions>

		<!-- Toolbar -->
		<StackPanel Grid.Row="0" Grid.ColumnSpan="2" Orientation="Horizontal" Margin="0,0,0,10">
			<Button Content="Add New" Command="{Binding AddCommand}"
                    Visibility="{Binding CanModify, Converter={StaticResource BoolToVisibilityConverter}}"
                    Padding="10,5" Background="#4CAF50" Foreground="White" BorderThickness="0"/>
		</StackPanel>

		<!-- List -->
		<DataGrid Grid.Row="1" Grid.Column="0"
                  ItemsSource="{Binding Users}"
                  SelectedItem="{Binding SelectedUser}"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  Margin="0,0,10,0" Width="auto">
			<DataGrid.Columns>
				<DataGridTextColumn Header="ID" Binding="{Binding UserId}" Width="60"/>
				<DataGridTextColumn Header="Username" Binding="{Binding Username}" Width="*"/>
				<DataGridTextColumn Header="Full Name" Binding="{Binding FullName}" Width="*"/>
				<DataGridTextColumn Header="Role" Binding="{Binding Role}" Width="100"/>
				<DataGridTextColumn Header="Customer" Binding="{Binding Customer.Name}" Width="150"/>
			</DataGrid.Columns>
		</DataGrid>

		<!-- Edit Form -->
		<Border Grid.Row="1" Grid.Column="1"
                BorderBrush="#E0E0E0" BorderThickness="1"
                Padding="10"
                Visibility="{Binding SelectedUser, Converter={StaticResource NullToVisibilityConverter}}">
			<ScrollViewer VerticalScrollBarVisibility="Auto">
				<StackPanel>
					<TextBlock Text="User Details" FontSize="16" FontWeight="Bold" Margin="0,0,0,15"/>

					<TextBlock Text="Username:" Margin="0,0,0,5"/>
					<TextBox Text="{Binding SelectedUser.Username, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0,0,0,10" Padding="5"/>

					<TextBlock Text="Password:" Margin="0,0,0,5"/>
					<TextBox Text="{Binding SelectedUser.Password, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0,0,0,10" Padding="5"/>

					<TextBlock Text="Full Name:" Margin="0,0,0,5"/>
					<TextBox Text="{Binding SelectedUser.FullName, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0,0,0,10" Padding="5"/>

					<TextBlock Text="Role:" Margin="0,0,0,5"/>
					<ComboBox x:Name="RoleComboBox"
                              ItemsSource="{Binding Roles}"
                              SelectedItem="{Binding SelectedUser.Role, UpdateSourceTrigger=PropertyChanged}"
                              SelectionChanged="RoleComboBox_SelectionChanged"
                              Margin="0,0,0,10" Padding="5"/>

					<!-- Customer Information Section (visible only when Role = Customer) -->
					<Border BorderBrush="#2196F3" BorderThickness="2"
                            Padding="10" Margin="0,0,0,10"
                            Background="#E3F2FD"
                            Visibility="{Binding IsCustomerRole, Converter={StaticResource BoolToVisibilityConverter}}">
						<StackPanel>
							<TextBlock Text="ðŸ“‹ Customer Information (New Customer)"
                                       FontWeight="Bold" FontSize="14"
                                       Foreground="#1976D2"
                                       Margin="0,0,0,10"/>

							<TextBlock Text="âš ï¸ A new customer will be created for this user"
                                       FontStyle="Italic"
                                       Foreground="#666"
                                       TextWrapping="Wrap"
                                       Margin="0,0,0,10"/>

							<TextBlock Text="Customer Name: *" Margin="0,0,0,5" FontWeight="SemiBold"/>
							<TextBox Text="{Binding CustomerName, UpdateSourceTrigger=PropertyChanged}"
                                     Margin="0,0,0,10" Padding="5"
                                     ToolTip="Enter the full name of the customer"/>

							<TextBlock Text="Phone:" Margin="0,0,0,5"/>
							<TextBox Text="{Binding CustomerPhone, UpdateSourceTrigger=PropertyChanged}"
                                     Margin="0,0,0,10" Padding="5"
                                     ToolTip="Enter customer's phone number (optional)"/>

							<TextBlock Text="Email:" Margin="0,0,0,5"/>
							<TextBox Text="{Binding CustomerEmail, UpdateSourceTrigger=PropertyChanged}"
                                     Margin="0,0,0,10" Padding="5"
                                     ToolTip="Enter customer's email address (optional)"/>
						</StackPanel>
					</Border>

					<CheckBox Content="Active"
                              IsChecked="{Binding SelectedUser.IsActive}"
                              Margin="0,0,0,20"/>

					<StackPanel Orientation="Horizontal">
						<Button Content="Save" Command="{Binding SaveCommand}"
                                Visibility="{Binding CanModify, Converter={StaticResource BoolToVisibilityConverter}}"
                                Padding="15,5" Margin="0,0,5,0"
                                Background="#2196F3" Foreground="White" BorderThickness="0"/>
						<Button Content="Delete" Command="{Binding DeleteCommand}"
                                Visibility="{Binding CanModify, Converter={StaticResource BoolToVisibilityConverter}}"
                                Padding="15,5" Margin="0,0,5,0"
                                Background="#F44336" Foreground="White" BorderThickness="0"/>
						<Button Content="Cancel" Command="{Binding CancelCommand}"
                                Padding="15,5"/>
					</StackPanel>
				</StackPanel>
			</ScrollViewer>
		</Border>
	</Grid>
</UserControl>